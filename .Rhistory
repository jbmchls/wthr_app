auroc_pval <- df %>%
tidyr::pivot_longer(
cols = ends_with("p.value"),
names_to = "comp_string",
values_to = "p_value",
names_repair = "minimal"
) %>% mutate(Component = stringr::str_extract(comp_string, "\\d+")) %>%
select(Block, Component, p_value)
model_vars <- df %>% select(model, Block, model_vars, variable, sex)
auroc_df <- full_join(auroc_auc, auroc_pval) %>% right_join(model_vars, by = "model")
return(auroc_df)
})
#res_df <- do.call(rbind, csv_list)
#return(res_df)
}
auroc_stats <- combine_results("auroc_stats")
combine_results <- function(tablename){
files <- list.files(file.path(wdir, "results"),
pattern=paste0("^",tablename,"\\.csv$"),
full.names = TRUE, recursive = TRUE)
print(paste(length(files), "files will be combined."))
csv_list <- lapply(files, function(i){
proj_pair <- basename(dirname(dirname(i)))
model_vars <- basename(dirname(i))
df <- read.csv(i, check.names = FALSE) %>%
rename("Block" = 1) %>%
mutate(model_vars = model_vars) %>%
tidyr::extract(model_vars,
into = c("variable", "sex"),
regex = "^(.*)_(male|female|all)", remove = FALSE) %>%
mutate(model = paste(proj_pair, model_vars, sep="_"), .before = 1)
auroc_auc <- df %>%
tidyr::pivot_longer(
cols = ends_with("AUC"),
names_to = "comp_string",
values_to = "AUC",
names_repair = "minimal"
) %>% mutate(Component = stringr::str_extract(comp_string, "\\d+")) %>%
select(Block, Component, AUC)
auroc_pval <- df %>%
tidyr::pivot_longer(
cols = ends_with("p.value"),
names_to = "comp_string",
values_to = "p_value",
names_repair = "minimal"
) %>% mutate(Component = stringr::str_extract(comp_string, "\\d+")) %>%
select(Block, Component, p_value)
model_vars <- df %>% select(model, Block, model_vars, variable, sex)
auroc_df <- full_join(auroc_auc, auroc_pval) %>% right_join(model_vars)
return(auroc_df)
})
#res_df <- do.call(rbind, csv_list)
#return(res_df)
}
auroc_stats <- combine_results("auroc_stats")
View(auroc_stats[[1]])
combine_results <- function(tablename){
files <- list.files(file.path(wdir, "results"),
pattern=paste0("^",tablename,"\\.csv$"),
full.names = TRUE, recursive = TRUE)
print(paste(length(files), "files will be combined."))
csv_list <- lapply(files, function(i){
proj_pair <- basename(dirname(dirname(i)))
model_vars <- basename(dirname(i))
df <- read.csv(i, check.names = FALSE) %>%
rename("Block" = 1) %>%
mutate(model_vars = model_vars) %>%
tidyr::extract(model_vars,
into = c("variable", "sex"),
regex = "^(.*)_(male|female|all)", remove = FALSE) %>%
mutate(model = paste(proj_pair, model_vars, sep="_"), .before = 1)
auroc_auc <- df %>%
tidyr::pivot_longer(
cols = ends_with("AUC"),
names_to = "comp_string",
values_to = "AUC",
names_repair = "minimal"
) %>% mutate(Component = stringr::str_extract(comp_string, "\\d+")) %>%
select(Block, Component, AUC)
auroc_pval <- df %>%
tidyr::pivot_longer(
cols = ends_with("p.value"),
names_to = "comp_string",
values_to = "p_value",
names_repair = "minimal"
) %>% mutate(Component = stringr::str_extract(comp_string, "\\d+")) %>%
select(Block, Component, p_value)
model_vars <- df %>% select(model, Block, model_vars, variable, sex)
auroc_df <- full_join(model_vars, auroc_auc) %>% left_join(auroc_pval)
return(auroc_df)
})
res_df <- do.call(rbind, csv_list)
return(res_df)
}
auroc_stats <- combine_results("auroc_stats")
View(model_stats)
colnames(model_stats)
colnames(auroc_stats)
final_model_stats <- left_join(model_stats, auroc_stats)
auroc_stats <- combine_results("auroc_stats") %>% mutate(Component = as.integer(Component))
final_model_stats <- left_join(model_stats, auroc_stats)
View(final_model_stats)
ber_table <- read.csv("results/ranked_BER_n270_models.xlsx", check.names = FALSE)
getwd()
getwd()
ber_table <- read.csv("results/ranked_BER_n270_models.csv", check.names = FALSE)
View(ber_table)
final_model_stats <- left_join(model_stats, auroc_stats) %>% left_join(ber_table)
View(final_model_stats)
write.csv(final_model_stats, "results/model_stats_combined_n270.csv", row.names = FALSE)
getwd()
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
wdir <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(wdir)
library(dplyr)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/ALL_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/ALL_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/ALL_biomarkers_20250602.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/ALL_biomarkers_omics.csv",
"../SingleMarker_Results/Model_without_Age/Cross_sectional/ALL_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_without_Age/Cross_sectional/ALL_biomarkers_omics.csv",
"../SingleMarker_Results/Model_without_Age/Longitudinal/ALL_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_without_Age/Longitudinal/ALL_biomarkers_omics.csv")
biom_res <- lapply(results_list, read.csv)
biom_res_df <- bind_rows(biom_res) %>% select(c(1:3,8,9)) %>% distinct()
#write.csv(biom_res_df, "single_marker_results_20250603.csv")
View(biom_res_df)
sig_biom_res_df <- biom_res_df %>% filter(p_value_f < pval_threshold)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_20250602.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_without_Age/Cross_sectional/sig_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_without_Age/Cross_sectional/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_without_Age/Longitudinal/sig_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_without_Age/Longitudinal/sig_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
sig_biom_res_df_v2 <- bind_rows(biom_res) %>% select(c(1:3,8,9)) %>% distinct()
View(sig_biom_res_df_v2)
length(unique(biomarker_res_df_v2))
length(unique(sig_biom_res_df_v2))
length(unique(sig_biom_res_df_v2$biomarker_assay))
lapply(sig_biom_res, nrow)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_20250602.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
sig_biom_res_df_v2 <- bind_rows(biom_res) %>% select(c(1:3,8,9)) %>% distinct()
length(unique(sig_biom_res_df_v2$biomarker_assay))
lapply(sig_biom_res, nrow)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_20250602.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
lapply(sig_biom_res, nrow)
sig_biom_res_df_v2 <- bind_rows(sig_biom_res) %>% select(c(1:3,8,9)) %>% distinct()
length(unique(sig_biom_res_df_v2$biomarker_assay))
sig_biom_res_df_v2 <- bind_rows(sig_biom_res)
View(sig_biom_res_df_v2)
sig_biom_res_df_v2 <- bind_rows(sig_biom_res) %>% select(c(1:3,8,9)) %>% distinct()
View(sig_biom_res_df_v2)
sig_biom_res_df_v2 <- bind_rows(sig_biom_res) %>% select(c(1:3,8,9))
sig_biom_res_df_v2 <- bind_rows(sig_biom_res) %>% select(c(1:3,8,9)) %>% distinct()
sig_biom_res_df_v2 <- bind_rows(sig_biom_res) %>% select(c(1:3,8,9)) %>% distinct()
duplicated(sig_biom_res_df_v2)
sig_biom_res_df_v2[which(duplicated(sig_biom_res_df_v2)),]
sig_biom_res_df_v2 <- bind_rows(sig_biom_res) %>% select(c(1:3)) %>% distinct()
sig_biom_res_df_v2 <- bind_rows(sig_biom_res) %>% select(c(1:3,8,9)) %>% distinct()
length(unique(sig_biom_res_df_v2$biomarker_assay))
write.csv(biom_res_df, "../SingleMarker_Results/Model_with_Age/SIG_single_marker_results_n673.csv")
write.csv(biom_res_df, "../SingleMarker_Results/Model_with_Age/SIG_single_marker_results_n673.csv", row.names = FALSE)
write.csv(sig_biom_res_df_v2, "../SingleMarker_Results/Model_with_Age/SIG_single_marker_results_n673.csv", row.names = FALSE)
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
wdir <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(wdir)
library(dplyr)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_20250602.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
lapply(sig_biom_res, nrow)
sig_biom_res_df_v2_allCols <- bind_rows(sig_biom_res)
sig_biom_res_df_v2 <- sig_biom_res_df_v2_allCols
length(unique(sig_biom_res_df_v2$biomarker_assay)) %>% select(c(1:3,8,9)) %>% distinct()
sig_biom_res_df_v2 <- sig_biom_res_df_v2_allCols %>% select(c(1:3,8,9)) %>% distinct()
View(sig_biom_res_df_v2)
View(sig_biom_res_df_v2_allCols)
View(sig_biom_res_df_v2_allCols %>% filter(is.na(p_value_f)))
View(sig_biom_res_df_v2_allCols %>% filter(is.na(p_value_f)))
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
# working directory; the results to combine should all be here
wdir <- dirname(rstudioapi::getSourceEditorContext()$path)
# directory for results of this script
res_dir <- "../../../../../Biomarker_Summary_Tables"
combine_results <- function(tablename){
files <- list.files(wdir, pattern=paste0("^",tablename,".*\\.csv$"), full.names = TRUE)
print("The following files will be combined:")
print(files)
cat("\n\n")
csv_list <- lapply(files, function(i){
df <- read.csv(i, check.names = FALSE)
return(df)
})
res_df <- do.call(rbind, csv_list) %>%
mutate(project_id = as.character(project_id))
return(res_df)
}
main_effects_df <- combine_results("main_effects")
contrasts_df <- combine_results("contrasts")
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_20250602.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_20250602.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
lapply(sig_biom_res, nrow)
sig_biom_res_df_v2_allCols <- bind_rows(sig_biom_res)
sig_biom_res_df_v2 <- sig_biom_res_df_v2_allCols %>% select(c(1:3,8,9)) %>% distinct()
length(unique(sig_biom_res_df_v2$biomarker_assay))
sig_biom_res_df_v2_allCols %>% filter(is.na(p_value_f))
#write.csv(sig_biom_res_df_v2, "../SingleMarker_Results/Model_with_Age/SIG_single_marker_results_n673.csv", row.names = FALSE)
write.csv(sig_biom_res_df_v2_allCols,
"../SingleMarker_Results/Model_with_Age/SIG_single_marker_results_n673_allCols.csv", row.names = FALSE)
View(sig_biom_res)
View(sig_biom_res[[3]])
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
library(dplyr)
#library(writexl)
# working directory; the results to combine should all be here
wdir <- dirname(rstudioapi::getSourceEditorContext()$path)
# directory for results of this script
res_dir <- "../../../../../Biomarker_Summary_Tables"
combine_results <- function(tablename){
files <- list.files(wdir, pattern=paste0("^",tablename,".*\\.csv$"), full.names = TRUE)
print("The following files will be combined:")
print(files)
cat("\n\n")
csv_list <- lapply(files, function(i){
df <- read.csv(i, check.names = FALSE)
return(df)
})
res_df <- do.call(rbind, csv_list) %>%
mutate(project_id = as.character(project_id))
return(res_df)
}
main_effects_df <- combine_results("main_effects")
contrasts_df <- combine_results("contrasts")
sig_biomarkers <- adj_biomarkers %>%
filter(`Pr(>F)` < pval_threshold)
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
library(dplyr)
#library(writexl)
# working directory; the results to combine should all be here
wdir <- dirname(rstudioapi::getSourceEditorContext()$path)
# directory for results of this script
res_dir <- "../../../../../Biomarker_Summary_Tables"
combine_results <- function(tablename){
files <- list.files(wdir, pattern=paste0("^",tablename,".*\\.csv$"), full.names = TRUE)
print("The following files will be combined:")
print(files)
cat("\n\n")
csv_list <- lapply(files, function(i){
df <- read.csv(i, check.names = FALSE)
return(df)
})
res_df <- do.call(rbind, csv_list) %>%
mutate(project_id = as.character(project_id))
return(res_df)
}
main_effects_df <- combine_results("main_effects")
contrasts_df <- combine_results("contrasts")
adj_biomarkers <- main_effects_df %>%
group_by(arm, project_id) %>%
mutate(n_tests = n()) %>%
ungroup() %>%
mutate(pval_threshold = 0.05/n_tests, .after = `Pr(>F)`)
sig_biomarkers <- adj_biomarkers %>%
filter(`Pr(>F)` < pval_threshold)
sig_contrasts <- contrasts_df %>%
filter(biomarker_assay %in% sig_biomarkers$biomarker_assay)
tally_biomarkers <- adj_biomarkers %>%
group_by(arm, project_id) %>%
summarize(
significant = sum(`Pr(>F)` < pval_threshold, na.rm = TRUE),
not_sig = sum(`Pr(>F)` >= pval_threshold, na.rm = TRUE)
)
View(adj_biomarkers)
date <- as.character(format(Sys.Date(), "%Y%m%d"))
write.csv(contrasts_df,
file = paste0(wdir, "/ALL_contrasts_", date,".csv"), row.names = FALSE)
write.csv(adj_biomarkers,
file = paste0(wdir, "/ALL_biomarkers_", date,".csv"), row.names = FALSE)
write.csv(sig_biomarkers,
file = paste0(wdir, "/SIG_biomarkers_", date,".csv"), row.names = FALSE)
write.csv(sig_contrasts,
file = paste0(wdir, "/SIG_biomarker_contrasts_", date,".csv"), row.names = FALSE)
write.csv(tally_biomarkers,
file = paste0(wdir), row.names = FALSE)
View(tally_biomarkers)
write.csv(tally_biomarkers,
file = paste0(wdir, "/tally_biomarkers_sig_", date, ".csv"), row.names = FALSE)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_20250911.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/sig_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_20250911.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/sig_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/SIG_biomarkers_20250911.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/SIG_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/SIG_biomarkers_20250911.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/SIG_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/SIG_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/SIG_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/SIG_biomarkers_20250911.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/SIG_biomarkers_omics.csv")
sig_biom_res <- lapply(results_list, read.csv)
View(sig_biom_res)
setdiff(sig_biom_res[[3]]$biomarker_assay, sig_biom_res[[4]]$biomarker_assay)
setdiff(sig_biom_res[[4]]$biomarker_assay, sig_biom_res[[3]]$biomarker_assay)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/SIG_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/SIG_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/SIG_biomarkers_20250911.csv")
sig_biom_res <- lapply(results_list, read.csv)
lapply(sig_biom_res, nrow)
sig_biom_res_df_v2_allCols <- bind_rows(sig_biom_res)
sig_biom_res_df_v2 <- sig_biom_res_df_v2_allCols %>% select(c(1:3,8,9)) %>% distinct()
length(unique(sig_biom_res_df_v2$biomarker_assay))
sig_biom_res_df_v2_allCols %>% filter(is.na(p_value_f))
View(sig_biom_res_df_v2_allCols)
sig_biom_res_df_v2_allCols %>% filter(is.na(p_value_f))
sig_biom_res_df_v2_allCols <- bind_rows(sig_biom_res)
sig_biom_res_df_v2 <- sig_biom_res_df_v2_allCols %>% select(c(1:3,8,9)) %>% distinct()
length(unique(sig_biom_res_df_v2$biomarker_assay))
filter(sig_biom_res_df_v2, is.na(p_value_f))
filter(sig_biom_res_df_v2, is.na(p_value_f)) %>% nrow()
lapply(sig_biom_res, colnames)
filter(sig_biom_res[[1]], is.na(p_value_f)) %>% nrow()
filter(sig_biom_res[[2]], is.na(p_value_f)) %>% nrow()
filter(sig_biom_res[[3]], is.na(p_value_f)) %>% nrow()
tally_biomarkers <- adj_biomarkers %>%
group_by(arm, project_id) %>%
summarize(
significant = sum(`Pr(>F)` < pval_threshold, na.rm = TRUE),
not_sig = sum(`Pr(>F)` >= pval_threshold, na.rm = TRUE)
) %>% rename("p_value_f" = "Pr(>F)")
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
library(dplyr)
#library(writexl)
# working directory; the results to combine should all be here
wdir <- dirname(rstudioapi::getSourceEditorContext()$path)
# directory for results of this script
res_dir <- "../../../../../Biomarker_Summary_Tables"
combine_results <- function(tablename){
files <- list.files(wdir, pattern=paste0("^",tablename,".*\\.csv$"), full.names = TRUE)
print("The following files will be combined:")
print(files)
cat("\n\n")
csv_list <- lapply(files, function(i){
df <- read.csv(i, check.names = FALSE)
return(df)
})
res_df <- do.call(rbind, csv_list) %>%
mutate(project_id = as.character(project_id))
return(res_df)
}
main_effects_df <- combine_results("main_effects")
contrasts_df <- combine_results("contrasts")
adj_biomarkers <- main_effects_df %>%
group_by(arm, project_id) %>%
mutate(n_tests = n()) %>%
ungroup() %>%
mutate(pval_threshold = 0.05/n_tests, .after = `Pr(>F)`)
sig_biomarkers <- adj_biomarkers %>%
filter(`Pr(>F)` < pval_threshold)
sig_contrasts <- contrasts_df %>%
filter(biomarker_assay %in% sig_biomarkers$biomarker_assay)
tally_biomarkers <- adj_biomarkers %>%
group_by(arm, project_id) %>%
summarize(
significant = sum(`Pr(>F)` < pval_threshold, na.rm = TRUE),
not_sig = sum(`Pr(>F)` >= pval_threshold, na.rm = TRUE)
) %>% rename("p_value_f" = "Pr(>F)")
View(adj_biomarkers)
colnames(adj_biomarkers)
tally_biomarkers <- adj_biomarkers %>%
group_by(arm, project_id) %>%
summarize(
significant = sum(`Pr(>F)` < pval_threshold, na.rm = TRUE),
not_sig = sum(`Pr(>F)` >= pval_threshold, na.rm = TRUE)
) %>% rename("p_value_f" = "Pr(>F)")
tally_biomarkers <- adj_biomarkers %>%
group_by(arm, project_id) %>%
summarize(
significant = sum(`Pr(>F)` < pval_threshold, na.rm = TRUE),
not_sig = sum(`Pr(>F)` >= pval_threshold, na.rm = TRUE)
)
View(tally_biomarkers)
adj_biomarkers <- main_effects_df %>%
group_by(arm, project_id) %>%
mutate(n_tests = n()) %>%
ungroup() %>%
mutate(pval_threshold = 0.05/n_tests, .after = `Pr(>F)`) %>%
rename("p_value_f" = "Pr(F)")
main_effects_df <- combine_results("main_effects") $>$ rename("p_value_f" = "Pr(F)")
main_effects_df <- combine_results("main_effects") %>% rename("p_value_f" = "Pr(F)")
View(main_effects_df)
?rename
main_effects_df <- combine_results("main_effects") %>% rename("p_value_f" = "Pr(>F)")
adj_biomarkers <- main_effects_df %>%
group_by(arm, project_id) %>%
mutate(n_tests = n()) %>%
ungroup() %>%
mutate(pval_threshold = 0.05/n_tests, .after = p_value_f)
sig_biomarkers <- adj_biomarkers %>%
filter(`Pr(>F)` < pval_threshold)
sig_biomarkers <- adj_biomarkers %>%
filter(p_value_f < pval_threshold)
sig_contrasts <- contrasts_df %>%
filter(biomarker_assay %in% sig_biomarkers$biomarker_assay)
tally_biomarkers <- adj_biomarkers %>%
group_by(arm, project_id) %>%
summarize(
significant = sum(p_value_f < pval_threshold, na.rm = TRUE),
not_sig = sum(p_value_f >= pval_threshold, na.rm = TRUE)
)
date <- as.character(format(Sys.Date(), "%Y%m%d"))
write.csv(contrasts_df,
file = paste0(wdir, "/ALL_contrasts_", date,".csv"), row.names = FALSE)
write.csv(adj_biomarkers,
file = paste0(wdir, "/ALL_biomarkers_", date,".csv"), row.names = FALSE)
write.csv(sig_biomarkers,
file = paste0(wdir, "/SIG_biomarkers_", date,".csv"), row.names = FALSE)
write.csv(sig_contrasts,
file = paste0(wdir, "/SIG_biomarker_contrasts_", date,".csv"), row.names = FALSE)
write.csv(tally_biomarkers,
file = paste0(wdir, "/tally_biomarkers_sig_", date, ".csv"), row.names = FALSE)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/SIG_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/SIG_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/SIG_biomarkers_20250911.csv")
sig_biom_res <- lapply(results_list, read.csv)
lapply(sig_biom_res, nrow)
sig_biom_res_df_v2_allCols <- bind_rows(sig_biom_res)
sig_biom_res_df_v2_allCols %>% filter(is.na(p_value_f)) %>% nrow()
sig_biom_res_df_v2 <- sig_biom_res_df_v2_allCols %>% select(c(1:3,8,9)) %>% distinct()
length(unique(sig_biom_res_df_v2$biomarker_assay))
write.csv(sig_biom_res_df_v2, "../SingleMarker_Results/Model_with_Age/SIG_single_marker_results_n673.csv", row.names = FALSE)
write.csv(sig_biom_res_df_v2_allCols,
"../SingleMarker_Results/Model_with_Age/SIG_single_marker_results_n673_allCols.csv", row.names = FALSE)
results_list <- list(
"../SingleMarker_Results/Model_with_Age/Cross_sectional/ALL_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_with_Age/Cross_sectional/ALL_biomarkers_omics.csv",
"../SingleMarker_Results/Model_with_Age/Longitudinal/ALL_biomarkers_20250911.csv",
"../SingleMarker_Results/Model_without_Age/Cross_sectional/ALL_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_without_Age/Cross_sectional/ALL_biomarkers_omics.csv",
"../SingleMarker_Results/Model_without_Age/Longitudinal/ALL_biomarkers_20250603.csv",
"../SingleMarker_Results/Model_without_Age/Longitudinal/ALL_biomarkers_omics.csv")
biom_res <- lapply(results_list, read.csv)
biom_res_df <- bind_rows(biom_res) %>% select(c(1:3,8,9)) %>% distinct()
sig_biom_res_df <- biom_res_df %>% filter(p_value_f < pval_threshold)
write.csv(biom_res_df, "../ALL_single_marker_results.csv")
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE)
wdir <- dirname(rstudioapi::getSourceEditorContext()$path)
setwd(wdir)
write.csv(biom_res_df, "../ALL_single_marker_results.csv")
getwd()
write.csv(biom_res_df, "../SingleMarker_Results/ALL_single_marker_results.csv")
?interaction
sig_biom_res_df_v2 <- sig_biom_res_df_v2_allCols %>% select(c(1:3,8,9)) %>% distinct()
length(unique(sig_biom_res_df_v2$biomarker_assay))
shiny::runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
?geom_line
runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
Sys.Date()
Sys.Date() -3
Sys.Date() -0303
Sys.Date() -60
Sys.Date() -90
june_this_year <- make_date(year = year(Sys.Date()), month = 6, day = 1)
june_this_year <- as.Date(paste0(format(Sys.Date(), "%Y"), "-06-01"))
june_this_year
june_this_year <- as.Date(paste0(format(Sys.Date(), "%Y"), "-03-14"))
as.Date(paste0(format(Sys.Date(), "%Y"), "-03-14"))
shiny::runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
runApp('C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr')
getwd()
setwd("C:/Users/jbmchls/OneDrive - Indiana University/Apps/wthr/")
runApp()
runApp()
